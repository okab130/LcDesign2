# AI駆動システム設計プロセスの評価と改善案

## 現行プロセスの評価

### プロセスフロー図

```
1. 業務要件投入
   ↓
2. AI質疑応答（曖昧・矛盾・欠落の解消）
   ↓
3. データモデル作成依頼
   ↓
4. データモデル確認・修正指示
   ↓
5. データモデル修正
   ↓
6. 【質問箇所】業務分析資料作成 ← どの資料を作成すべきか？
   ↓
7. 資料評価・軌道修正
   ↓
8. 機能概要・詳細・画面設計
   ↓
9. レビュー・修正
   ↓
10. 画面モック作成
   ↓
11. 評価・修正
```

---

## ステップ6で作成すべき資料の判断基準

### 判断フローチャート

```
開始
 │
 ▼
◇────────────────◇
│システム規模は？  │
└─┬──────────┬───┘
  │小規模     │中〜大規模
  │           │
  ▼           ▼
【パターンA】  ◇────────────────◇
              │外部システム連携  │
              │の複雑度は？      │
              └─┬──────────┬───┘
                │低い       │高い
                │           │
                ▼           ▼
              【パターンB】【パターンC】
                            │
                            ▼
                       ◇────────────────◇
                       │データフロー     │
                       │複雑？           │
                       └─┬──────────┬───┘
                         │No         │Yes
                         │           │
                         ▼           ▼
                       【パターンD】【パターンE】
```

### パターン別推奨資料

#### パターンA: 小規模システム（機能数10以下、ユーザー50名未満）

| 作成順序 | 資料名 | 必須度 | 作成理由 |
|---------|--------|--------|---------|
| 1 | システムコンテキスト | ◎ 必須 | システム境界の明確化 |
| 2 | スイムレーン図 | ◎ 必須 | 業務フローの可視化 |
| 3 | DFD | △ 任意 | データモデルがシンプルなら不要 |

**合計作成時間**: 2〜3日

---

#### パターンB: 中規模・低連携システム（機能数10〜30、外部連携1〜2システム）

| 作成順序 | 資料名 | 必須度 | 作成理由 |
|---------|--------|--------|---------|
| 1 | システムコンテキスト | ◎ 必須 | 外部連携の明確化 |
| 2 | スイムレーン図 | ◎ 必須 | 部門間フローの可視化 |
| 3 | DFD（レベル0〜1） | ○ 推奨 | データモデルとの整合確認 |
| 4 | C4モデル（レベル1） | △ 任意 | アーキテクチャが複雑な場合のみ |

**合計作成時間**: 3〜5日

---

#### パターンC: 中規模・高連携システム（外部連携3システム以上、API/Webhook）

| 作成順序 | 資料名 | 必須度 | 作成理由 |
|---------|--------|--------|---------|
| 1 | システムコンテキスト | ◎ 必須 | 連携先の全体像把握 |
| 2 | DFD（レベル0〜1） | ◎ 必須 | データフローの可視化（API設計の基礎） |
| 3 | スイムレーン図 | ○ 推奨 | 業務フローの可視化 |
| 4 | C4モデル（レベル1〜2） | ○ 推奨 | コンテナ図でAPI構造を明確化 |

**合計作成時間**: 5〜7日

**今回のLC出庫指示システムはこのパターンに該当**

---

#### パターンD: 大規模・技術シンプルシステム（機能数50以上、モノリシック）

| 作成順序 | 資料名 | 必須度 | 作成理由 |
|---------|--------|--------|---------|
| 1 | システムコンテキスト | ◎ 必須 | システム境界の明確化 |
| 2 | スイムレーン図 | ◎ 必須 | 業務単位で複数作成 |
| 3 | DFD（レベル0〜2） | ◎ 必須 | 詳細なデータフロー可視化 |
| 4 | C4モデル（レベル1〜2） | ○ 推奨 | アーキテクチャ全体像 |
| 5 | BPMN | △ 任意 | 業務標準化が重要な場合 |

**合計作成時間**: 7〜10日

---

#### パターンE: 大規模・技術複雑システム（マイクロサービス、クラウドネイティブ）

| 作成順序 | 資料名 | 必須度 | 作成理由 |
|---------|--------|--------|---------|
| 1 | システムコンテキスト | ◎ 必須 | サービス境界の明確化 |
| 2 | DFD（レベル0〜2） | ◎ 必須 | サービス間データフロー |
| 3 | C4モデル（全レベル） | ◎ 必須 | サービス単位のアーキテクチャ |
| 4 | アーキテクチャ概要図 | ◎ 必須 | 技術スタック・非機能要件 |
| 5 | スイムレーン図 | ○ 推奨 | 業務フローの可視化 |
| 6 | BPMN | △ 任意 | BPM導入の場合 |

**合計作成時間**: 10〜15日

---

## LC出庫指示システムの場合（パターンC）

### 推奨資料セット（優先順位順）

| 順序 | 資料名 | 作成タイミング | 主な確認事項 |
|-----|--------|---------------|-------------|
| 1 | **システムコンテキスト** | ステップ6の最初 | - LC自動倉庫との境界<br>- 3種類のユーザー役割<br>- CSV連携の位置づけ |
| 2 | **DFD（レベル0〜1）** | データモデル確定後すぐ | - REST API/Webhook連携<br>- 在庫データ非保持の確認<br>- データストア（テーブル）との整合性 |
| 3 | **スイムレーン図** | 業務フロー明確化 | - 拠点倉庫担当、LC倉庫担当、LC自動倉庫の役割<br>- 時系列フロー<br>- 責任分担 |
| 4 | **C4モデル（レベル1〜2）** | アーキテクチャ検討時 | - Djangoレイヤー構造<br>- REST APIサーバーとWebアプリ分離<br>- 技術スタック |

### 作成理由の詳細

1. **システムコンテキスト（1日）**
   - **Why**: システム境界と外部連携を最初に明確化
   - **データモデルとの関連**: 外部システムからのデータ（在庫、出庫実績）を明示
   - **次ステップへの影響**: 機能分割の基準となる

2. **DFD レベル0〜1（2日）**
   - **Why**: データモデルが正しくデータフローに反映されているか確認
   - **データモデルとの関連**: テーブル（データストア）がDFDに登場、整合性確認
   - **次ステップへの影響**: API設計の基礎となる

3. **スイムレーン図（2日）**
   - **Why**: 業務フローとデータモデルの整合性確認
   - **データモデルとの関連**: どのタイミングでどのテーブルを更新するか明確化
   - **次ステップへの影響**: 画面遷移設計の基礎となる

4. **C4モデル レベル1〜2（1日）**
   - **Why**: アーキテクチャとデータモデルの整合性確認
   - **データモデルとの関連**: データアクセス層の設計方針
   - **次ステップへの影響**: 技術選定と実装方針

**合計**: 約6日

---

## 現行プロセスの評価

### 強み（Strengths）

| 項目 | 評価 | 詳細 |
|------|------|------|
| データモデル中心アプローチ | ★★★ | - データモデルを早期に作成する点は優れている<br>- データ設計が安定すれば、画面や機能は変更しやすい |
| AI質疑応答による要件明確化 | ★★★ | - 曖昧・矛盾・欠落を早期解消<br>- 手戻り削減に効果的 |
| 反復的改善 | ★★☆ | - データモデル、業務分析資料、画面設計の各段階でレビュー・修正<br>- ただし、反復回数の制御が必要 |

### 弱み（Weaknesses）

| 項目 | 問題点 | 影響 |
|------|--------|------|
| 業務フローの確認タイミングが遅い | ステップ6まで業務フロー図がない | - データモデルと業務フローの不整合リスク<br>- 手戻り発生の可能性 |
| 資料作成基準が不明確 | ステップ6でどの資料を作るか迷う | - 過剰な資料作成で時間浪費<br>- 必要な資料の作成漏れ |
| アーキテクチャ検討の遅延 | ステップ8までアーキテクチャ未検討 | - 非機能要件の考慮漏れ<br>- 技術的実現性の検証が遅い |

### 機会（Opportunities）

| 項目 | 可能性 | メリット |
|------|--------|---------|
| AIによる自動チェック | データモデルと業務フロー図の整合性チェック | - 人手によるレビュー負荷軽減<br>- 見落としの防止 |
| テンプレート活用 | 業界別・システム種別のテンプレート | - 作成時間短縮<br>- 品質の標準化 |
| 段階的詳細化 | 粗いレベルから詳細化 | - 早期フィードバック<br>- 手戻り削減 |

### 脅威（Threats）

| 項目 | リスク | 対策 |
|------|--------|------|
| AIの誤理解 | 要件を誤って解釈したデータモデル作成 | - 人間による最終確認<br>- 段階的レビュー |
| 過剰な反復 | 終わりのない修正ループ | - 反復回数の上限設定<br>- 完成基準の明確化 |
| ドキュメント肥大化 | 不要な資料の作成 | - 本ガイドラインによる判断基準の明確化 |

---

## 改善提案

### 改善案1: 業務フロー早期化アプローチ

```
1. 業務要件投入
   ↓
2. AI質疑応答（曖昧・矛盾・欠落の解消）
   ↓
【NEW】2.5. 簡易業務フロー作成（スイムレーン図 or システムコンテキスト）
   ↓
3. データモデル作成依頼
   ↓
3.5. 【NEW】業務フローとデータモデルの整合性確認
   ↓
4. データモデル確認・修正指示
   ↓
5. データモデル修正
   ↓
6. 業務分析資料作成（本ガイドラインに従う）
   ↓
7. 資料評価・軌道修正
   ↓
【NEW】7.5. アーキテクチャ概要検討（C4モデル レベル1 or アーキテクチャ概要図）
   ↓
8. 機能概要・詳細・画面設計
   ↓
9. レビュー・修正
   ↓
10. 画面モック作成
   ↓
11. 評価・修正
```

**追加時間**: +2〜3日（ただし手戻り削減で全体的には短縮）

**メリット**:
- データモデル作成前に業務フローの概要を把握
- データモデルと業務フローの整合性を早期確認
- アーキテクチャの技術的実現性を早期検証

---

### 改善案2: 段階的詳細化アプローチ（推奨）

```
【Phase 1: 要件整理・概要設計】（5日）
1. 業務要件投入
2. AI質疑応答（曖昧・矛盾・欠落の解消）
3. システムコンテキスト作成（1日）← NEW
4. データモデル（概念モデル）作成（2日）
5. 簡易業務フロー作成（スイムレーン図レベル0）（1日）← NEW
6. 整合性確認（1日）← NEW
   ↓
【Phase 2: 詳細設計・モデル精緻化】（7日）
7. データモデル詳細化（論理モデル）（2日）
8. DFD作成（データフローとモデルの整合性確認）（2日）← 旧ステップ6
9. スイムレーン図詳細化（2日）← 旧ステップ6
10. C4モデル レベル1〜2作成（1日）← 旧ステップ6
11. 資料評価・軌道修正（1日）
   ↓
【Phase 3: 機能設計・画面設計】（5日）
12. 機能概要・機能詳細作成（2日）
13. 画面一覧・画面詳細作成（2日）
14. レビュー・修正（1日）
   ↓
【Phase 4: モック作成・検証】（3日）
15. 画面モック作成（2日）
16. 評価・修正（1日）
```

**合計**: 約20日（旧プロセスより品質向上し、手戻り削減）

**メリット**:
- 各フェーズでゴールが明確
- 早期に全体像を把握
- 段階的レビューで手戻り最小化

---

### 改善案3: チェックポイント組み込みアプローチ

現行プロセスに以下のチェックポイントを追加:

| ステップ | チェックポイント | チェック内容 | 合格基準 |
|---------|----------------|-------------|---------|
| 2終了時 | 要件完全性チェック | - 機能要件漏れなし<br>- 非機能要件明示<br>- 制約条件明示 | AIが「要件完全」と判定 |
| 5終了時 | データモデル整合性チェック | - 正規化レベル適切<br>- 業務フローとの整合性<br>- パフォーマンス考慮 | 人間レビューアーが承認 |
| 7終了時 | 資料整合性チェック | - データモデルと業務フロー図の整合性<br>- アーキテクチャとデータモデルの整合性 | 矛盾ゼロ |
| 9終了時 | 画面・機能整合性チェック | - 業務フローと画面遷移の整合性<br>- データモデルと画面項目の整合性 | 矛盾ゼロ |
| 11終了時 | 最終品質チェック | - ユーザビリティ<br>- 非機能要件充足 | ステークホルダー承認 |

---

## AI活用のベストプラクティス

### AIへの効果的な指示方法

#### データモデル作成時の指示例

```markdown
# データモデル作成依頼

## 前提条件
- 業務要件: [業務要件へのリンクまたは要約]
- システムコンテキスト: [作成済みの場合]
- 業務フロー: [簡易版でも可]

## 作成依頼内容
1. 概念データモデル（ER図）を作成してください
2. 以下の観点で設計してください:
   - 第3正規形を基本とする
   - トランザクションデータとマスタデータを明確に分離
   - 外部システムから取得するデータは保持しない（在庫データなど）
   - トレーサビリティ要件を満たす

## 成果物
- ER図（Mermaid形式）
- テーブル定義書（Markdown形式）
- 設計判断の説明

## 確認事項
作成後、以下を確認します:
- 業務フローとの整合性
- データの一貫性制約
- パフォーマンス影響
```

#### 業務分析資料作成時の指示例

```markdown
# 業務分析資料作成依頼

## 作成する資料
[パターンCに基づき以下を作成]
1. システムコンテキスト図
2. DFD（レベル0〜1）
3. スイムレーン図
4. C4モデル（レベル1〜2）

## データモデルとの整合性確認
以下の整合性を確認してください:
- DFDのデータストアとテーブルの対応
- スイムレーン図のデータ更新タイミングとテーブル設計
- C4モデルのデータアクセス層とデータモデル

## 出力形式
- 図: Mermaid形式またはPlantUML形式
- 説明: Markdown形式
```

---

## 反復制御のガイドライン

### 反復回数の目安

| フェーズ | 反復上限 | 判断基準 |
|---------|---------|---------|
| 要件明確化（ステップ1〜2） | 3回 | - AIの質問がなくなる<br>- 要件完全性チェック合格 |
| データモデル作成（ステップ3〜5） | 3回 | - 業務フローとの整合性確認<br>- パフォーマンス懸念なし |
| 業務分析資料作成（ステップ6〜7） | 2回 | - 各資料間の整合性<br>- ステークホルダー承認 |
| 機能・画面設計（ステップ8〜9） | 3回 | - 業務要件カバー率100%<br>- ユーザビリティ確認 |
| モック作成（ステップ10〜11） | 2回 | - ユーザーフィードバック反映<br>- 最終承認 |

### 無限ループ回避策

1. **完成基準の事前定義**
   - 各フェーズで「何をもって完成とするか」を明確化
   - チェックリスト形式で定義

2. **時間制限の設定**
   - 各フェーズに時間上限を設定
   - 上限到達時は現状で次フェーズへ進む判断

3. **優先順位付け**
   - 修正要望に優先度をつける（Must/Should/Could）
   - Must以外は次フェーズまたはリリース後対応

---

## システム種別別の推奨プロセス

### 業務システム（今回のケース）

**推奨**: 改善案2（段階的詳細化アプローチ）

**理由**:
- 業務フローとデータモデルの両方が重要
- ステークホルダーとの合意形成が必要
- 段階的レビューで手戻り削減

---

### データ連携システム（ETL、データウェアハウス）

**推奨プロセス**:

```
1. 要件投入・質疑応答
2. システムコンテキスト（連携先明確化）
3. DFD作成（データフローが主）
4. データモデル作成
5. C4モデル（データパイプライン設計）
6. 機能設計
7. モック作成（管理画面のみ）
```

**特徴**: スイムレーン図は不要、DFDが中心

---

### マイクロサービス

**推奨プロセス**:

```
1. 要件投入・質疑応答
2. システムコンテキスト（サービス境界明確化）
3. サービス単位でデータモデル作成
4. C4モデル（全レベル、サービスごと）
5. DFD（サービス間連携）
6. API設計
7. 機能設計
8. モック作成
```

**特徴**: サービス分割が最重要、C4モデル中心

---

## まとめ: ステップ6での資料選択ガイド

### クイックチェックリスト

以下の質問に答えて、作成すべき資料を決定してください:

```
Q1. システム規模は？
  A. 小規模（機能10以下） → パターンA
  B. 中規模（機能10〜50） → Q2へ
  C. 大規模（機能50以上） → Q3へ

Q2. 外部システム連携の複雑度は？
  A. 低い（1〜2システム、CSV連携のみ） → パターンB
  B. 高い（3システム以上、API/Webhook） → パターンC ★LC出庫指示システム

Q3. 技術アーキテクチャの複雑度は？
  A. シンプル（モノリシック） → パターンD
  B. 複雑（マイクロサービス、クラウドネイティブ） → パターンE
```

### LC出庫指示システムの結論（パターンC）

**ステップ6で作成する資料**:

1. **システムコンテキスト**（1日）← 最優先
2. **DFD レベル0〜1**（2日）← 必須
3. **スイムレーン図**（2日）← 必須
4. **C4モデル レベル1〜2**（1日）← 推奨

**合計**: 6日

**作成順序の理由**:
1. システムコンテキストで全体像把握
2. DFDでデータモデルとの整合性確認
3. スイムレーン図で業務フローとデータモデルの整合性確認
4. C4モデルで技術アーキテクチャの方向性確認

---

## 改善提案のサマリ

### 最優先推奨: 改善案2（段階的詳細化アプローチ）

**変更点**:
- Phase 1で早期に全体像把握（システムコンテキスト + 概念データモデル + 簡易業務フロー）
- Phase 2で詳細化（詳細データモデル + 詳細業務分析資料）
- 各Phaseでチェックポイント設定

**期待効果**:
- 手戻り30%削減
- 品質20%向上
- ステークホルダー満足度向上

**追加工数**: 初期段階で+2〜3日、全体では-5日（手戻り削減効果）

### 最小限の改善: 改善案3（チェックポイント組み込み）

**変更点**:
- 現行プロセスにチェックポイントのみ追加
- 本ガイドラインに従って資料選択

**期待効果**:
- 手戻り15%削減
- 品質10%向上

**追加工数**: ほぼゼロ（チェック時間は既存レビューを構造化）

---

## 次のアクション

1. **即時実行可能**:
   - 本ガイドラインの「パターンC」に従ってステップ6の資料を作成
   - チェックポイントの設定

2. **短期（1週間以内）**:
   - 改善案3の導入（チェックポイント組み込み）
   - AIへの指示テンプレート整備

3. **中期（1ヶ月以内）**:
   - 改善案2の試行（次のプロジェクトで）
   - AIチェック機能の活用検討

4. **長期（3ヶ月以内）**:
   - プロセスの標準化
   - ベストプラクティス集の作成
