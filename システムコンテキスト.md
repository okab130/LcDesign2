# システムコンテキスト図

## 1. システムコンテキスト概要

LC出庫指示システムは、LC自動倉庫への出庫依頼の管理と、在庫・出庫実績の照会を行うWebシステムです。LC自動倉庫システム、配送拠点マスタ提供システムと連携し、倉庫業務を支援します。

## 2. システムコンテキスト図

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        アルファ飲料 業務システム全体                          │
│                                                                         │
│  ┌──────────────┐                                     ┌──────────────┐  │
│  │   拠点倉庫   │                                     │ LC倉庫担当   │  │
│  │    担当      │                                     │              │  │
│  │  (30拠点)   │                                     │              │  │
│  └──────┬───────┘                                     └──────┬───────┘  │
│         │                                                    │          │
│         │ 出庫依頼登録                                       │出庫依頼  │
│         │ 在庫照会                                           │送信操作  │
│         │ 実績照会                                           │在庫照会  │
│         │                                                    │実績照会  │
│         ▼                                                    ▼          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                 │   │
│  │               LC出庫指示システム (対象システム)                   │   │
│  │                                                                 │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │   │
│  │  │ 出庫依頼管理  │  │ 在庫照会機能  │  │ 実績検索機能  │         │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘         │   │
│  │                                                                 │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │   │
│  │  │商品マスタ管理 │  │ユーザー管理   │  │拠点マスタ管理 │         │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘         │   │
│  │                                                                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│         │                           ▲                                  │
│         │                           │                                  │
│         │ REST API                  │ Webhook                          │
│         │ 出庫依頼送信               │ 出庫実績受信                      │
│         │ 在庫情報取得               │                                  │
│         ▼                           │                                  │
│  ┌─────────────────────────────────────────────┐                       │
│  │                                             │                       │
│  │      LC自動倉庫システム                       │                       │
│  │      (検討対象外)                            │                       │
│  │                                             │                       │
│  │  ・在庫管理（パレット単位）                   │                       │
│  │  ・在庫引当処理                              │                       │
│  │  ・自動出庫処理                              │                       │
│  │  ・手動出庫処理                              │                       │
│  │  ・REST API提供                             │                       │
│  │                                             │                       │
│  └─────────────────────────────────────────────┘                       │
│                                                                         │
│         ▲                                                               │
│         │ CSV取り込み                                                   │
│         │ (手動)                                                        │
│         │                                                               │
│  ┌──────┴──────────────┐                                               │
│  │  配送拠点マスタ       │                                               │
│  │  提供システム         │                                               │
│  │  (別システム)         │                                               │
│  └─────────────────────┘                                               │
│                                                                         │
│  ┌──────────────┐                                                      │
│  │   管理者     │                                                      │
│  │ (情報システム │                                                      │
│  │     部門)    │                                                      │
│  └──────┬───────┘                                                      │
│         │ユーザー管理                                                   │
│         │マスタ取り込み                                                 │
│         ▼                                                               │
│    (LC出庫指示システム)                                                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## 3. 外部システムとの連携

### 3.1 LC自動倉庫システム（検討対象外）

**連携方式**: REST API（HTTP/HTTPS）

**データフロー**:
- **出庫依頼送信**: LC出庫指示システム → LC自動倉庫システム（POST）
- **在庫情報取得**: LC出庫指示システム → LC自動倉庫システム（GET）
- **出庫実績受信**: LC自動倉庫システム → LC出庫指示システム（POST - Webhook）

**通信プロトコル**:
- 開発テスト環境: HTTP（認証なし）
- 本番環境: HTTPS（TLS 1.2以上）、JWT認証

**エンドポイント** (開発テスト環境):
- 在庫情報取得: `GET http://localhost:5001/api/v1/inventory`
- 出庫依頼送信: `POST http://localhost:5001/api/v1/shipment-requests`
- 出庫実績受信: `POST http://localhost:8000/api/v1/shipment-results`

### 3.2 配送拠点マスタ提供システム（別システム）

**連携方式**: CSVファイル（共有フォルダ経由）

**データフロー**:
- 配送拠点マスタ提供システム → 共有フォルダ（CSV配置）
- LC出庫指示システム（管理者/LC倉庫担当が手動取り込み）

**ファイル形式**:
- ファイル名: `delivery_base_YYYYMMDD.csv`
- 文字コード: UTF-8
- ヘッダ: あり
- データ種別: 全量データ（前日データを削除して入れ替え）

**データ項目**:
- 拠点コード
- 拠点名

## 4. システム利用者

### 4.1 拠点倉庫担当（30拠点）
- **役割**: 配送拠点への在庫補充のための出庫依頼登録
- **利用機能**:
  - 出庫依頼登録画面
  - 在庫照会画面
  - 出庫実績検索画面
- **権限**: 所属拠点のデータのみ操作可能

### 4.2 LC倉庫担当
- **役割**: 出庫依頼の確認・送信、在庫管理、商品マスタ管理
- **利用機能**:
  - 出庫依頼一覧・修正・送信画面
  - 在庫照会画面
  - 出庫実績検索画面
  - 商品マスタ管理画面
  - 配送拠点マスタ取り込み画面
- **権限**: 全拠点のデータを操作可能

### 4.3 管理者（情報システム部門）
- **役割**: システムユーザーの管理、マスタ取り込み
- **利用機能**:
  - ユーザー管理画面
  - 配送拠点マスタ取り込み画面
- **権限**: ユーザー管理のみ

## 5. システム境界

### 5.1 対象範囲
- 出庫依頼の登録・管理・REST API送信
- 在庫情報のREST API取得・画面表示
- 出庫実績のWebhook受信・格納
- 各種検索・照会機能
- 商品マスタ管理
- ユーザー管理
- 配送拠点マスタのCSV取り込み

### 5.2 対象外範囲（LC自動倉庫システムの責任範囲）
- 在庫引当ロジック
- 在庫ステータス管理
- 出庫作業の実施
- パレットの物理的な管理
- REST APIエンドポイントの提供

## 6. 技術スタック

### 6.1 開発テスト環境
- **Webフレームワーク**: Django
- **REST API**: Django REST framework
- **データベース**: SQLite3
- **HTTP クライアント**: requests ライブラリ
- **認証**: なし
- **通信プロトコル**: HTTP
- **システムURL**: http://localhost:8000
- **モックサーバURL**: http://localhost:5001

### 6.2 本番環境（移行時の変更点）
- **データベース**: PostgreSQL 14+
- **認証**: JWT認証（djangorestframework-simplejwt）
- **通信プロトコル**: HTTPS（TLS 1.2以上）
- **APIエンドポイントURL**: 本番環境URLに変更

## 7. 非機能要件サマリ

### 7.1 セキュリティ
- 開発テスト環境では認証なし
- 本番環境ではJWT認証必須
- HTTPS通信必須（本番環境）

### 7.2 データ保持
- 出庫実績データは削除・アーカイブ不要
- **在庫データはデータベースに保持しない**（都度LC APIから取得）

### 7.3 エラーハンドリング
- 在庫情報取得・出庫依頼送信: 画面にポップアップでエラー表示（リトライなし）
- 出庫実績受信: HTTPエラーレスポンス返却、ログ出力
- 配送拠点マスタ取り込み: 画面にエラー表示

## 8. 業務フローサマリ

1. **拠点倉庫担当**: 翌日配送分の出庫依頼を登録（18:00までに推奨、締切なし）
2. **LC倉庫担当**: 翌日、出庫依頼一覧で全拠点の依頼を確認
3. **LC倉庫担当**: 在庫状況を確認し、必要に応じて数量調整
4. **LC倉庫担当**: 送信対象の依頼を選択し、REST API送信
5. **LC自動倉庫システム**: 在庫引当・出庫処理を実施
6. **LC自動倉庫システム**: 出庫完了後、出庫実績をWebhookで送信
7. **LC出庫指示システム**: 出庫実績を受信し、データベースに格納
