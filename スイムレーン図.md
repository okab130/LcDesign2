# スイムレーン図

## 1. 出庫依頼の作成・送信フロー

```
┌────────────────┬──────────────────────┬──────────────────────┬──────────────────────┐
│  レーン        │  拠点倉庫担当         │  LC倉庫担当           │  LC自動倉庫システム    │
├────────────────┼──────────────────────┼──────────────────────┼──────────────────────┤
│                │                      │                      │                      │
│ 依頼登録       │  [開始]              │                      │                      │
│ (当日18:00迄   │    │                 │                      │                      │
│  推奨)         │    ▼                 │                      │                      │
│                │ ログイン              │                      │                      │
│                │    │                 │                      │                      │
│                │    ▼                 │                      │                      │
│                │ 出庫依頼登録画面      │                      │                      │
│                │ - 配送予定日自動設定   │                      │                      │
│                │   (翌営業日)          │                      │                      │
│                │ - 複数商品入力        │                      │                      │
│                │    │                 │                      │                      │
│                │    ▼                 │                      │                      │
│                │ 一時保存？            │                      │                      │
│                │    │ はい            │                      │                      │
│                │    ├─────→ [保存]    │                      │                      │
│                │    │ いいえ           │                      │                      │
│                │    ▼                 │                      │                      │
│                │ 数量バリデーション     │                      │                      │
│                │ (パレット積載数の倍数) │                      │                      │
│                │    │ OK              │                      │                      │
│                │    ▼                 │                      │                      │
│                │ 登録（確定）          │                      │                      │
│                │ ステータス：作成済     │                      │                      │
│                │    │                 │                      │                      │
│                │  [終了]              │                      │                      │
│                │                      │                      │                      │
├────────────────┼──────────────────────┼──────────────────────┼──────────────────────┤
│                │                      │                      │                      │
│ 依頼確認       │                      │  [開始]              │                      │
│ ・送信         │                      │    │                 │                      │
│ (翌日)         │                      │    ▼                 │                      │
│                │                      │ ログイン              │                      │
│                │                      │    │                 │                      │
│                │                      │    ▼                 │                      │
│                │                      │ 出庫依頼一覧画面      │                      │
│                │                      │ - 全拠点の依頼を表示  │                      │
│                │                      │    │                 │                      │
│                │                      │    ▼                 │                      │
│                │                      │ 在庫照会画面          │                      │
│                │                      │ 「最新化」ボタン押下  │                      │
│                │                      │    │                 │                      │
│                │                      │    ▼                 │                      │
│                │                      │ REST API呼び出し     │                      │
│                │                      │ GET /inventory       │                      │
│                │                      │    │─────────────────┼────────→             │
│                │                      │    │                 │  在庫情報取得         │
│                │                      │    │                 │    │                 │
│                │                      │    │                 │    ▼                 │
│                │                      │    │◀────────────────┼──  JSON応答          │
│                │                      │    │                 │                      │
│                │                      │    ▼                 │                      │
│                │                      │ 在庫確認              │                      │
│                │                      │    │                 │                      │
│                │                      │    ▼                 │                      │
│                │                      │ 在庫不足？            │                      │
│                │                      │    │ はい            │                      │
│                │  ◀───────────────────┼─  拠点倉庫担当へ連絡  │                      │
│ 数量調整要請    │                      │    │                 │                      │
│    │           │                      │    ▼                 │                      │
│    ▼           │                      │ 依頼修正              │                      │
│ 依頼修正        │─────────────────────→│ (数量調整)           │                      │
│    │           │                      │    │                 │                      │
│    ▼           │                      │    │ いいえ           │                      │
│  [終了]        │                      │    ▼                 │                      │
│                │                      │ 送信対象を選択        │                      │
│                │                      │ (チェックボックス)    │                      │
│                │                      │ - 複数拠点選択可能    │                      │
│                │                      │    │                 │                      │
│                │                      │    ▼                 │                      │
│                │                      │ 送信ボタン押下        │                      │
│                │                      │    │                 │                      │
│                │                      │    ▼                 │                      │
│                │                      │ REST API呼び出し     │                      │
│                │                      │ POST /shipment-      │                      │
│                │                      │      requests        │                      │
│                │                      │    │─────────────────┼────────→             │
│                │                      │    │                 │  出庫依頼受信         │
│                │                      │    │                 │    │                 │
│                │                      │    │                 │    ▼                 │
│                │                      │    │                 │  APIバリデーション   │
│                │                      │    │                 │    │                 │
│                │                      │    │                 │    ▼                 │
│                │                      │    │◀────────────────┼──  JSON応答          │
│                │                      │    │                 │  (成功/失敗)         │
│                │                      │    ▼                 │                      │
│                │                      │ 送信結果確認          │                      │
│                │                      │ - 成功: ステータス    │                      │
│                │                      │   「送信済」          │                      │
│                │                      │ - 失敗: ステータス    │                      │
│                │                      │   「エラー」          │                      │
│                │                      │ - 一部失敗: 成功分のみ│                      │
│                │                      │   「送信済」          │                      │
│                │                      │    │                 │                      │
│                │                      │  [終了]              │                      │
│                │                      │                      │                      │
├────────────────┼──────────────────────┼──────────────────────┼──────────────────────┤
│                │                      │                      │                      │
│ 出庫処理       │                      │                      │  [開始]              │
│                │                      │                      │    │                 │
│                │                      │                      │    ▼                 │
│                │                      │                      │ 出庫依頼受信          │
│                │                      │                      │    │                 │
│                │                      │                      │    ▼                 │
│                │                      │                      │ 在庫引当処理          │
│                │                      │                      │    │                 │
│                │                      │                      │    ▼                 │
│                │                      │                      │ 自動出庫処理          │
│                │                      │                      │ (パレット単位)        │
│                │                      │                      │    │                 │
│                │                      │                      │    ▼                 │
│                │                      │                      │ 出庫完了              │
│                │                      │                      │    │                 │
│                │                      │                      │    ▼                 │
│                │                      │                      │ 出庫実績作成          │
│                │                      │                      │    │                 │
│                │                      │                      │    ▼                 │
│                │                      │                      │ Webhook送信          │
│                │                      │                      │ POST /shipment-      │
│                │                      │                      │      results         │
│                │                      │    ◀────────────────┼────────              │
│                │                      │    │                 │                      │
│                │                      │    ▼                 │                      │
│                │                      │ 出庫実績受信          │                      │
│                │                      │ データベース格納      │                      │
│                │                      │    │                 │                      │
│                │                      │    ▼                 │                      │
│                │                      │ HTTPレスポンス返却    │                      │
│                │                      │    │─────────────────┼────────→             │
│                │                      │    │                 │  レスポンス確認       │
│                │                      │    │                 │    │                 │
│                │                      │    │                 │    ▼                 │
│                │                      │    │                 │  [終了]              │
│                │                      │  [終了]              │                      │
│                │                      │                      │                      │
└────────────────┴──────────────────────┴──────────────────────┴──────────────────────┘
```

## 2. 在庫照会フロー

```
┌────────────────┬──────────────────────┬──────────────────────┐
│  レーン        │  利用者              │  LC自動倉庫システム    │
│                │ (全ユーザー)          │                      │
├────────────────┼──────────────────────┼──────────────────────┤
│                │  [開始]              │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ ログイン              │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ 在庫照会画面          │                      │
│                │ (初回は空リスト表示)  │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ 「最新化」ボタン押下  │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ REST API呼び出し     │                      │
│                │ GET /inventory       │                      │
│                │    │─────────────────┼────────→             │
│                │    │                 │  全在庫情報取得       │
│                │    │                 │    │                 │
│                │    │                 │    ▼                 │
│                │    │                 │  JSON応答生成        │
│                │    │                 │  - パレットID        │
│                │    │                 │  - 商品情報          │
│                │    │                 │  - 製造情報          │
│                │    │                 │  - 賞味期限          │
│                │    │◀────────────────┼────────              │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ 画面表示              │                      │
│                │ (DBには保存しない)    │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ API呼び出し成功？     │                      │
│                │    │ いいえ           │                      │
│                │    ├─→ エラー        │                      │
│                │    │   ポップアップ表示│                      │
│                │    │                 │                      │
│                │    │ はい            │                      │
│                │    ▼                 │                      │
│                │ 在庫一覧表示          │                      │
│                │ - パレットID         │                      │
│                │ - 商品コード         │                      │
│                │ - 数量               │                      │
│                │ - ロケーション       │                      │
│                │ - 製造情報           │                      │
│                │ - 賞味期限           │                      │
│                │    │                 │                      │
│                │  [終了]              │                      │
│                │                      │                      │
└────────────────┴──────────────────────┴──────────────────────┘
```

## 3. 出庫実績検索フロー

```
┌────────────────┬──────────────────────┐
│  レーン        │  利用者              │
│                │ (全ユーザー)          │
├────────────────┼──────────────────────┤
│                │  [開始]              │
│                │    │                 │
│                │    ▼                 │
│                │ ログイン              │
│                │    │                 │
│                │    ▼                 │
│                │ 出庫実績検索画面      │
│                │    │                 │
│                │    ▼                 │
│                │ 検索条件入力          │
│                │ - 出庫日             │
│                │ - 配送拠点           │
│                │ - 商品コード         │
│                │ - パレットID         │
│                │ - 製造日             │
│                │ - 賞味期限           │
│                │ - 出庫依頼ID         │
│                │    │                 │
│                │    ▼                 │
│                │ 検索実行              │
│                │ (データベースから取得)│
│                │    │                 │
│                │    ▼                 │
│                │ 検索結果表示          │
│                │ - 自動出庫           │
│                │ - 手動出庫           │
│                │   (依頼IDなし)       │
│                │    │                 │
│                │    ▼                 │
│                │ 詳細確認              │
│                │ - 商品コード         │
│                │ - 製造工場           │
│                │ - 製造ライン         │
│                │ - 製造番号           │
│                │ - 製造年月日         │
│                │ - 賞味期限           │
│                │ - トレーサビリティ情報│
│                │    │                 │
│                │  [終了]              │
│                │                      │
└────────────────┴──────────────────────┘
```

## 4. 商品マスタ管理フロー

```
┌────────────────┬──────────────────────┐
│  レーン        │  LC倉庫担当          │
├────────────────┼──────────────────────┤
│                │  [開始]              │
│                │    │                 │
│                │    ▼                 │
│                │ ログイン              │
│                │    │                 │
│                │    ▼                 │
│                │ 商品マスタ管理画面    │
│                │    │                 │
│                │    ▼                 │
│                │ 操作選択              │
│                │    │                 │
│                ├────┼────────────────  │
│                │    ▼                 │
│  登録          │ 新規登録              │
│                │ - 商品コード         │
│                │ - 商品名             │
│                │ - パレット積載ケース数│
│                │    │                 │
│                │    ▼                 │
│                │ バリデーション        │
│                │    │                 │
│                │    ▼                 │
│                │ データベース登録      │
│                │    │                 │
│                │    ▼                 │
│                │ 完了メッセージ表示    │
│                │    │                 │
│                ├────┼────────────────  │
│                │    ▼                 │
│  更新          │ 既存データ検索        │
│                │    │                 │
│                │    ▼                 │
│                │ 商品情報編集          │
│                │    │                 │
│                │    ▼                 │
│                │ バリデーション        │
│                │    │                 │
│                │    ▼                 │
│                │ データベース更新      │
│                │    │                 │
│                │    ▼                 │
│                │ 完了メッセージ表示    │
│                │    │                 │
│                ├────┼────────────────  │
│                │    ▼                 │
│  削除          │ 既存データ検索        │
│  (論理削除)    │    │                 │
│                │    ▼                 │
│                │ 削除確認              │
│                │    │                 │
│                │    ▼                 │
│                │ 論理削除実行          │
│                │ (有効フラグ更新)      │
│                │    │                 │
│                │    ▼                 │
│                │ 完了メッセージ表示    │
│                │    │                 │
│                │    ▼                 │
│                │  [終了]              │
│                │                      │
└────────────────┴──────────────────────┘
```

## 5. ユーザー管理フロー

```
┌────────────────┬──────────────────────┐
│  レーン        │  管理者              │
│                │ (情報システム部門)    │
├────────────────┼──────────────────────┤
│                │  [開始]              │
│                │    │                 │
│                │    ▼                 │
│                │ ログイン              │
│                │    │                 │
│                │    ▼                 │
│                │ ユーザー管理画面      │
│                │    │                 │
│                │    ▼                 │
│                │ 操作選択              │
│                │    │                 │
│                ├────┼────────────────  │
│                │    ▼                 │
│  登録          │ 新規ユーザー登録      │
│                │ - ユーザーID         │
│                │ - パスワード         │
│                │ - ユーザー名         │
│                │ - ユーザー区分       │
│                │   (拠点倉庫/LC/管理者)│
│                │ - 所属拠点コード     │
│                │    │                 │
│                │    ▼                 │
│                │ バリデーション        │
│                │    │                 │
│                │    ▼                 │
│                │ データベース登録      │
│                │    │                 │
│                │    ▼                 │
│                │ 初期パスワード        │
│                │ メール送信            │
│                │    │                 │
│                ├────┼────────────────  │
│                │    ▼                 │
│  更新          │ 既存ユーザー検索      │
│                │    │                 │
│                │    ▼                 │
│                │ ユーザー情報編集      │
│                │    │                 │
│                │    ▼                 │
│                │ バリデーション        │
│                │    │                 │
│                │    ▼                 │
│                │ データベース更新      │
│                │    │                 │
│                ├────┼────────────────  │
│                │    ▼                 │
│  削除          │ 既存ユーザー検索      │
│                │    │                 │
│                │    ▼                 │
│                │ 削除確認              │
│                │    │                 │
│                │    ▼                 │
│                │ 有効フラグ更新        │
│                │ (論理削除)            │
│                │    │                 │
│                │    ▼                 │
│                │  [終了]              │
│                │                      │
└────────────────┴──────────────────────┘
```

## 6. 配送拠点マスタ取り込みフロー

```
┌────────────────┬──────────────────────┬──────────────────────┐
│  レーン        │  管理者/LC倉庫担当    │  配送拠点マスタ       │
│                │                      │  提供システム         │
├────────────────┼──────────────────────┼──────────────────────┤
│                │                      │  [開始]              │
│                │                      │    │                 │
│                │                      │    ▼                 │
│                │                      │ マスタデータ生成      │
│                │                      │    │                 │
│                │                      │    ▼                 │
│                │                      │ CSVファイル作成       │
│                │                      │ delivery_base_       │
│                │                      │ YYYYMMDD.csv         │
│                │                      │    │                 │
│                │                      │    ▼                 │
│                │                      │ 共有フォルダへ配置    │
│                │    ◀────────────────┼────────              │
│                │    │                 │                      │
│                │  [開始]              │  [終了]              │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ ログイン              │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ 配送拠点マスタ        │                      │
│                │ 取り込み画面          │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ 取り込みボタン押下    │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ 共有フォルダから      │                      │
│                │ 最新CSVファイル取得   │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ CSVファイル読み込み   │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ データバリデーション  │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ 前日データ削除        │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ 全量データ登録        │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ 取り込み結果確認？    │                      │
│                │    │ エラー           │                      │
│                │    ├─→ エラー        │                      │
│                │    │   メッセージ表示 │                      │
│                │    │                 │                      │
│                │    │ 成功            │                      │
│                │    ▼                 │                      │
│                │ 完了メッセージ表示    │                      │
│                │    │                 │                      │
│                │  [終了]              │                      │
│                │                      │                      │
└────────────────┴──────────────────────┴──────────────────────┘
```

## 7. 手動出庫フロー（参考）

```
┌────────────────┬──────────────────────┬──────────────────────┐
│  レーン        │  LC倉庫担当          │  LC自動倉庫システム    │
│                │ (LC倉庫システムで操作)│                      │
├────────────────┼──────────────────────┼──────────────────────┤
│                │  [開始]              │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ LC自動倉庫システム    │                      │
│                │ ログイン              │                      │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ 手動出庫指示          │                      │
│                │ - 緊急出庫           │                      │
│                │ - 廃棄               │                      │
│                │    │─────────────────┼────────→             │
│                │    │                 │  手動出庫処理         │
│                │    │                 │    │                 │
│                │    │                 │    ▼                 │
│                │    │                 │ 出庫完了              │
│                │    │                 │    │                 │
│                │    │                 │    ▼                 │
│                │    │                 │ 出庫実績作成          │
│                │    │                 │ (出庫依頼IDなし)     │
│                │    │                 │    │                 │
│                │    │                 │    ▼                 │
│                │    │                 │ Webhook送信          │
│                │    │                 │ POST /shipment-      │
│                │    │                 │      results         │
│                │    ◀────────────────┼────────              │
│                │    │                 │                      │
│  (出庫指示     │    ▼                 │                      │
│   システム側)  │ 出庫実績受信          │                      │
│                │ データベース格納      │                      │
│                │ (出庫依頼との紐付けなし)│                    │
│                │    │                 │                      │
│                │    ▼                 │                      │
│                │ 出庫実績検索画面で    │                      │
│                │ 参照可能              │                      │
│                │    │                 │                      │
│                │  [終了]              │  [終了]              │
│                │                      │                      │
└────────────────┴──────────────────────┴──────────────────────┘
```
